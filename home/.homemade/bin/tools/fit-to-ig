#! /usr/bin/env bash

# Author:       Arturo Aguilar Lagunas
# Date:         Sat Dec 11 12:16:23 AM CST 2021
# Description:  Fit image into a predefined resolution

# max resolution for ig: 1080x1350
ig_res=1080x1350
bg="bg.png"
overlay="overlay.png"
bg_color="white"

if [[ ! -n $1 ]]; then
    echo -e "[+] Usage: $0 <image.ext>"
else
    # set output file name
    if [[ ! -n $2 ]]; then
        out="output.png"
    else
        out="$2"
    fi

    # print info
    echo -e "[+] input: $1"
    echo -e "[+] output: $out"
    echo -e "[+] bg color: $bg_color"
    echo -e "[+] old res: $(convert $1 -print "%wx%h\n" /dev/null)"
    echo -e "[+] new res: $ig_res"

    # generate background
    # convert -blur 0x7 -resize $ig_res\! $1 bg-$out
    convert -size $ig_res canvas:$bg_color $bg
    # generate overlay image
    convert -resize $ig_res $1 $overlay
    # generate output
    convert -composite -gravity center $bg $overlay $out

    # remove tmp files
    rm $bg $overlay
fi
